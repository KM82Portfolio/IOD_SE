<!DOCTYPE html>

<head>
    <link rel="stylesheet" href="./css/style.css">
</head>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>  

    $( document ).ready(function() {
        let transactionTable = '{"transactionTable":[]}';//initialize Table of Transaction Details for user to fill in using form
    });

    function store_ddlSelect(elemid){
        let sType = document.getElementById(elemid);
        selection=sType.options[sType.selectedIndex].value;
        let selectionType=elemid.toString();
        localStorage.setItem(selectionType, selection);
        document.getElementById('test_area3').innerHTML=localStorage.getItem(selectionType);//testing only
        return selection;
    }

    function storeTransaction(){//called by store transaction
        transactionAmount = document.getElementById('transactionAmount').value;
        localStorage.setItem("Amount", transactionAmount);
        document.getElementById('test_area3').innerHTML=localStorage.getItem("Amount");//test
    }
    //LONGER TERM SOLUTION TO STORE EACH ENTRY AS JSON OBJECT See Adding a new array element to a JSON object in OneNote
    
    function logDate() {
        $('#dateChecker').on('click', function(){
        var date = new Date($('#transactionDatePicker').val());
        day = date.getDate();
        month = date.getMonth() + 1;
        year = date.getFullYear();
        transactionDate=[day, month, year].join('/')
        localStorage.setItem("transactionDate", transactionDate);
        });
    };

    function updateJSON(){
        
        //create string of new transaction object
        let tt1="transactionDate:"+localStorage.getItem("transactionDate");
        let tt2="ddlselectType"+localStorage.getItem("ddlselectType");
        let tt3="ddlselectCategory"+localStorage.getItem("ddlselectCategory");
        let tt4="Amount"+localStorage.getItem("Amount");
        newTransaction= "{"+tt1+","+tt2+","+tt3+","+tt4+"}";
        
        //push new transaction object into existing transactionTable
        let parse_obj = JSON.parse(transactionTable);
        parse_obj['transactionTable'].push({"teamId":"4","status":"pending"});
        transactionTable = JSON.stringify(parse_obj);
        localStorage.setItem("transactionTable", transactionTable);
    }
    
    function addRow(){
        let tt1='<tr>';
        let tt2=$('<td></td>').text(localStorage.getItem("transactionDate"));;
        let tt3=$('<td></td>').text(localStorage.getItem("ddlselectType"));
        let tt4=$('<td></td>').text(localStorage.getItem("ddlselectCategory"));
        let tt5=$('<td></td>').text(localStorage.getItem("Amount"));
        let tt6='</tr>';
        $('#transactionTable').after(tt1,tt2,tt3,tt4,tt5,tt6);
    }

</script>
    

<fieldset id="transactionDetails">

    <label for="transactionDatePicker">Select Transaction Date</label>
    <input type="date" id="transactionDatePicker" onchange="logDate()"/>
    <button onclick="logDate()" id="dateChecker">Log Transaction Date</button>

    <Legend>Enter Income/Expense Details Here</Legend>
    <p>
        <label for="ddlselectType">Select Income/Expense</label>
        <select name="ddlselectType" id="ddlselectType" onchange="store_ddlSelect('ddlselectType')">
            <option>Select Income/Expense</option>
            <option>Income</option>
            <option>Expense</option>
        </select>
    </p>
    
    <span id="test_area2"></span>
    
    <p>
        <label for="ddlselectCategory">Select Income/Expense Category</label>
        <select name="ddlselectCategory" id="ddlselectCategory" onchange="store_ddlSelect('ddlselectCategory')">
            <option class="Income Expense">Select Category</option>
            <option class="Income">Salary</option>
            <option class="Expense">Food</option> 
            <option class="Expense">Rent</option>
            <option class="Expense">Entertainment</option>
        </select>
    </p>
    
    <span id="test_area3"></span>
   
    <p>
        <label for="transactionAmount">Enter Amount</label>
        <input type="number" id="transactionAmount"/>
    </p>
    <button onclick="storeTransaction()">Confirm Transaction</button>

    <p id="test_area1"></p>
    <p id="test_area2"></p>
    <p id="test_area3"></p>
</fieldset>

<fieldset>
    <table id="transactionTable">
        <tr>
            <th>Time & Date</th>
            <th>Type</th>
            <th>Category</th>
            <th>Amount</th>
        </tr>
    </table>
    <button onclick="afterText()">jQuery Test</button>
    <button onclick="addRow()">jQuery Table Test</button>
</fieldset>
<p id="test_area4"></p>
</fieldset>

</html>